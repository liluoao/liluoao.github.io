<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>我所理解的接口设计（转） | To be a Web Artisan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="原文链接：https://segmentfault.com/a/1190000013703264 接口参数定义接口设计中往可以抽象出一些新的公共参数，我目前能想到了一些较为常见的公共接口参数如下：    公共参数 含意 定义该参数的意义     timestamp 毫秒级时间戳 1.客户端的请求时间标示 2.后端可以做请求过期验证 3.该参数参与签名算法增加签名的唯一性   app_key 签名公">
<meta property="og:type" content="article">
<meta property="og:title" content="我所理解的接口设计（转）">
<meta property="og:url" content="http://www.liluoao.com/2018/how-i-understand-restful-api.html">
<meta property="og:site_name" content="To be a Web Artisan">
<meta property="og:description" content="原文链接：https://segmentfault.com/a/1190000013703264 接口参数定义接口设计中往可以抽象出一些新的公共参数，我目前能想到了一些较为常见的公共接口参数如下：    公共参数 含意 定义该参数的意义     timestamp 毫秒级时间戳 1.客户端的请求时间标示 2.后端可以做请求过期验证 3.该参数参与签名算法增加签名的唯一性   app_key 签名公">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-12-16T08:27:39.757Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="我所理解的接口设计（转）">
<meta name="twitter:description" content="原文链接：https://segmentfault.com/a/1190000013703264 接口参数定义接口设计中往可以抽象出一些新的公共参数，我目前能想到了一些较为常见的公共接口参数如下：    公共参数 含意 定义该参数的意义     timestamp 毫秒级时间戳 1.客户端的请求时间标示 2.后端可以做请求过期验证 3.该参数参与签名算法增加签名的唯一性   app_key 签名公">
<meta name="twitter:creator" content="@liluoao">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">To be a Web Artisan</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">文章列表</a>
        
          <a class="main-nav-link" href="/categories/laravel">Laravel</a>
        
          <a class="main-nav-link" href="/categories/wechat">Wechat</a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://www.liluoao.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-我所理解的接口设计" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/how-i-understand-restful-api.html" class="article-date">
  <time datetime="2018-02-05T02:07:24.000Z" itemprop="datePublished">2018-02-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      我所理解的接口设计（转）
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>原文链接：<a href="https://segmentfault.com/a/1190000013703264" target="_blank" rel="noopener">https://segmentfault.com/a/1190000013703264</a></p>
<h2 id="接口参数定义"><a href="#接口参数定义" class="headerlink" title="接口参数定义"></a>接口参数定义</h2><p>接口设计中往可以抽象出一些新的公共参数，我目前能想到了一些较为常见的公共接口参数如下：</p>
<table>
<thead>
<tr>
<th>公共参数</th>
<th>含意</th>
<th>定义该参数的意义</th>
</tr>
</thead>
<tbody>
<tr>
<td>timestamp</td>
<td>毫秒级时间戳</td>
<td>1.客户端的请求时间标示 2.后端可以做请求过期验证 3.该参数参与签名算法增加签名的唯一性</td>
</tr>
<tr>
<td>app_key</td>
<td>签名公钥</td>
<td>签名算法的公钥，后端通过公钥可以得到对应的私钥</td>
</tr>
<tr>
<td>sign</td>
<td>接口签名</td>
<td>通过请求的参数和定义好的签名算法生成接口签名，作用防止中间人篡改请求参数</td>
</tr>
<tr>
<td>did</td>
<td>设备ID</td>
<td>设备的唯一标示，生成规则例如android的mac地址的md5和ios曾今udid(目前无法获取)的md5, 1:数据收集 2.便于问题追踪 3.消息推送标示</td>
</tr>
</tbody>
</table>
<a id="more"></a>
<h2 id="接口版本化的问题"><a href="#接口版本化的问题" class="headerlink" title="接口版本化的问题"></a>接口版本化的问题</h2><p>接口设计中有个算是历史上的难题 -&gt; 接口版本化。曾经也去调研了很多关于接口版本化的资料和设计，最后我得到的结论大致如下：</p>
<p>接口的版本区分为</p>
<ul>
<li><p>大版本</p>
<ul>
<li><p>原则：大版本的数量最多控制到5个以内(我个人跟倾向于3个)，超过版本限制的版本提示升级到新版本</p>
</li>
<li><p>方案<br>  uri携带版本号，例如：v1/user/get<br>  请求参数，例如：user/get?v=1.0</p>
</li>
</ul>
</li>
<li><p>小版本</p>
<ul>
<li><p>原则：自己把控吧😄</p>
</li>
<li><p>方案<br>  uri携带版本号，例如：v1/user/get_01<br>  请求参数，小数点右边就是小版本，例如：user/get?v=1.1</p>
</li>
</ul>
</li>
</ul>
<h2 id="接口的安全性"><a href="#接口的安全性" class="headerlink" title="接口的安全性"></a>接口的安全性</h2><p>接口的设计肯定绕不开安全这两个字，为了达到尽可能的安全，我们需要尽可能的增加被攻击的难度，以下是我了解和使用到的一些常见的手段去增加接口的安全性(https这里就不讨论了)：</p>
<pre><code>过期验证／签名验证／重放攻击／限流／转义
</code></pre><p>伪代码如下：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 过期验证</span></span><br><span class="line"><span class="keyword">if</span> (microtime(<span class="keyword">true</span>)*<span class="number">1000</span> - $_REQUEST[<span class="string">'timestamp'</span>] &gt; <span class="number">5000</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> \<span class="keyword">Exception</span>(<span class="number">401</span>, <span class="string">'Expired request'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 签名验证(公钥校验省略)</span></span><br><span class="line">$params = ksort($_REQUEST);</span><br><span class="line"><span class="keyword">unset</span>($params[<span class="string">'sign'</span>]);</span><br><span class="line">$sign = md5(sha1(implode(<span class="string">'-'</span>, $params) . $_REQUEST[<span class="string">'app_key'</span>]));</span><br><span class="line"><span class="keyword">if</span> ($sign !== $_REQUEST[<span class="string">'sign'</span>]) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> \<span class="keyword">Exception</span>(<span class="number">401</span>, <span class="string">'Invalid sign'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 重放攻击</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@params</span> noise string 随机字符串或随机正整数，与 Timestamp 联合起来, 用于防止重放攻击 例如腾讯云是6位随机正整数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">$key = md5(<span class="string">"&#123;$_REQUEST['REQUEST_URI']&#125;-&#123;$_REQUEST['timestamp']&#125;-&#123;$_REQUEST['noise']&#125;-&#123;$_REQUEST['did']&#125;"</span>);</span><br><span class="line"><span class="keyword">if</span> ($redisInstance-&gt;exists($key)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> \<span class="keyword">Exception</span>(<span class="number">401</span>, <span class="string">'Repeated request'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 限流</span></span><br><span class="line">$key = md5(<span class="string">"&#123;$_REQUEST['REQUEST_URI']&#125;-&#123;$_REQUEST['REMOTE_ADDR']&#125;-&#123;$_REQUEST['did']&#125;"</span>);</span><br><span class="line"><span class="keyword">if</span> ($redisInstance-&gt;get($key) &gt; <span class="number">60</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> \<span class="keyword">Exception</span>(<span class="number">401</span>, <span class="string">'Request limit'</span>);</span><br><span class="line">&#125;</span><br><span class="line">$redisInstance-&gt;incre($key);</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 转义</span></span><br><span class="line">$username = htmlspecialchars($_REQUEST[<span class="string">'username'</span>]);</span><br></pre></td></tr></table></figure>
<h2 id="接口的代码设计-gt-解耦业务-即插即用"><a href="#接口的代码设计-gt-解耦业务-即插即用" class="headerlink" title="接口的代码设计 -&gt; 解耦业务 即插即用"></a>接口的代码设计 -&gt; 解耦业务 即插即用</h2><blockquote>
<p>这个过程的关键字：抽象成类 前置中间件 注入</p>
</blockquote>
<p>接着就是我们代码设计的层面了，如何抽象公共的部分与业务代码解耦。</p>
<p>一般写法, 定义个全局函数，然后每个接口开始时调用该函数：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 全局定义一个函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 校验公共参数</span></span><br><span class="line">    <span class="comment"># code ...</span></span><br><span class="line">    <span class="comment">// 校验签名</span></span><br><span class="line">    <span class="comment"># code ...</span></span><br><span class="line">    <span class="comment">// 校验频率</span></span><br><span class="line">    <span class="comment"># code ...</span></span><br><span class="line">    <span class="comment">// 等等...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>二般写法, 定义个父类方法，然后每个接口类继承该接口，构造函数调用改方法，其实和上面的换汤不换药：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 父类方法</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">father</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;check();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">check</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 校验公共参数</span></span><br><span class="line">        <span class="comment"># code ...</span></span><br><span class="line">        <span class="comment">// 校验签名</span></span><br><span class="line">        <span class="comment"># code ...</span></span><br><span class="line">        <span class="comment">// 校验频率</span></span><br><span class="line">        <span class="comment"># code ...</span></span><br><span class="line">        <span class="comment">// 等等...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重点来了，我提倡的第三般写法，对象链和前置中间件：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 检验抽象类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Check</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 下一个check实体</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> object</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> $nextCheckInstance;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 校验方法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Request $request 请求对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">operate</span><span class="params">(Request $request)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置责任链上的下一个对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Check $check</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setNext</span><span class="params">(Check $check)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;nextCheckInstance = $check;</span><br><span class="line">        <span class="keyword">return</span> $check;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 启动</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Request $request 请求对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">start</span><span class="params">(Request $request)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;doCheck($request);</span><br><span class="line">        <span class="comment">// 调用下一个对象</span></span><br><span class="line">        <span class="keyword">if</span> (! <span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;nextCheckInstance)) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;nextCheckInstance-&gt;start($request);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 校验公共参数类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ParamsCheck</span> <span class="keyword">extends</span> <span class="title">Check</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">operate</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">       <span class="comment">// 校验公共参数</span></span><br><span class="line">        <span class="comment"># code ... </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 校验签名类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SignCheck</span> <span class="keyword">extends</span> <span class="title">Check</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">operate</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">       <span class="comment">// 校验签名</span></span><br><span class="line">        <span class="comment"># code ... </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等等...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 前置中间件类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FrontMiddleware</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 初始化一个：必传参数校验的check</span></span><br><span class="line">        $checkParams   =  <span class="keyword">new</span> ParamsCheck();</span><br><span class="line">        <span class="comment">// 初始化一个：签名check</span></span><br><span class="line">        $checkSign     =  <span class="keyword">new</span> SignCheck();</span><br><span class="line">        <span class="comment">// 初始化一个：频率check</span></span><br><span class="line">        $checkFrequent =  <span class="keyword">new</span> FrequentCheck();</span><br><span class="line">        <span class="comment">// 等等...</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构成对象链</span></span><br><span class="line">        $checkParams-&gt;setNext($checkSign)</span><br><span class="line">                    -&gt;setNext($checkFrequent)</span><br><span class="line">                    ...</span><br><span class="line">        <span class="comment">// 启动</span></span><br><span class="line">        $checkParams-&gt;start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="接口的可读性"><a href="#接口的可读性" class="headerlink" title="接口的可读性"></a>接口的可读性</h2><p>关于可读性的不得不提到的就是RESTFUL，这里我就不讨论RESTFUL，大家可以自行补充相关知识。关于接口设计可读性的我的一些思考：</p>
<ul>
<li><p>url</p>
<ul>
<li>非RESTFUL: 资源／资源／操作(动词)， 例如 content/article/get -&gt; 获取内容资源下的一篇文章资源</li>
<li>RESTFUL: 资源／资源／资源， 例如 get content/article/1 -&gt; 获取内容资源下文章ID为1的文章资源</li>
</ul>
</li>
<li><p>method</p>
<ul>
<li>非RESTFUL: get便于查nginx日志，上传资源post, 没啥硬性要求</li>
<li>RESTFUL: 符合RESTFUL的思想</li>
</ul>
</li>
<li><p>request params: 个人更青睐于下划线命名，适当的单词缩写</p>
</li>
<li><p>response params: 响应的code要符合http status</p>
<ul>
<li>200 -&gt; 正常</li>
<li>400 -&gt; 缺少公共必传参数或者业务必传参数</li>
<li>401 -&gt; 接口校验失败 例如签名</li>
<li>403 -&gt; 没有该接口的访问权限</li>
<li>499 -&gt; 上游服务响应时间超过接口设置的超时时间</li>
<li>500 -&gt; 代码错误</li>
<li>501 -&gt; 不支持的接口method</li>
<li>502 -&gt; 上游服务返回的数据格式不正确</li>
<li>503 -&gt; 上游服务超时</li>
<li>504 -&gt; 上游服务不可用</li>
</ul>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 响应的格式</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"code"</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">"msg"</span>: <span class="string">"ok"</span>,</span><br><span class="line">    <span class="attr">"data"</span>: &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="接口文档"><a href="#接口文档" class="headerlink" title="接口文档"></a>接口文档</h2><p>好的接口文档就是生产力， swagger + api blueprint 自行google吧😄</p>
<h2 id="我遇到的坑"><a href="#我遇到的坑" class="headerlink" title="我遇到的坑"></a>我遇到的坑</h2><p>这里遇到的一个比较大的坑就是http协议历史遗留的bug：</p>
<blockquote>
<p>不区分url里的空格 和加号➕</p>
</blockquote>
<p>带来的问题就是urldecode会把参数里的+号转为空格，所以这种场景的就得使用rawurldecode防止+转成空格。比如做接口的参数校验的时候～</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.liluoao.com/2018/how-i-understand-restful-api.html" data-id="ck486eg5m00533smjeb8hvirf" class="article-share-link">分享</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/analyze-some-array-function.html" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
        
          部分数组函数分析
        
      </div>
    </a>
  
  
    <a href="/2018/phpstorm-use-ftp.html" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">PHPStorm使用FTP</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/use-design-patterns.html">设计模式的应用</a>
          </li>
        
          <li>
            <a href="/2019/about-middle-end.html">大中台的思考</a>
          </li>
        
          <li>
            <a href="/2019/big-or-small-size-company.html">大小规模公司思考</a>
          </li>
        
          <li>
            <a href="/2019/vcs-commit-rule.html">版本控制工具提交规范</a>
          </li>
        
          <li>
            <a href="/2019/yaf-individualization.html">Yaf个性化</a>
          </li>
        
          <li>
            <a href="/2019/use-code-sniffer-in-phpstorm.html">在PHPStorm中添加CodeSniffer</a>
          </li>
        
          <li>
            <a href="/2019/mongodb-aggregation.html">MongoDB的聚合Aggregation</a>
          </li>
        
          <li>
            <a href="/2019/yii-batch-query.html">Yii批处理查询</a>
          </li>
        
          <li>
            <a href="/2019/problem-about-xhprof-in-php7.html">XHProf与PHP7的问题</a>
          </li>
        
          <li>
            <a href="/2018/use-sonarqube-continuous-code-quality.html">使用SonarQube管理代码质量</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/algorithm/">algorithm</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/alipay/">alipay</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/apache/">apache</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/design-patterns/">design-patterns</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kong/">kong</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/laravel/">laravel</a><span class="tag-list-count">21</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lua/">lua</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongo/">mongo</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openresty/">openresty</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/other/">other</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/phalcon/">phalcon</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/">php</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tool/">tool</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wechat/">wechat</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/yaf/">yaf</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/yii/">yii</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a><span class="archive-list-count">20</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a><span class="archive-list-count">20</span></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <div style="width:300px;margin:0 auto; padding:20px 0;">
          &copy; 2019 李罗奥
          Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">文章列表</a>
  
    <a href="/categories/laravel" class="mobile-nav-link">Laravel</a>
  
    <a href="/categories/wechat" class="mobile-nav-link">Wechat</a>
  
</nav>
    

<script src="//lib.sinaapp.com/js/jquery/3.1.0/jquery-3.1.0.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>