<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>重构代码 | To be a Web Artisan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="原文链接：https://juejin.im/post/5adc8e18518825672b0352a8  重构不是对以前代码的全盘否定，而是利用更好的方式，写出更好，更有维护性代码。不断的追求与学习，才有更多的进步。  什么是重构首先，重构不是重写。重构大概的意思是在不影响项目的功能使用前提下，使用一系列的重构方式，改变项目的内部结构。提高项目内部的可读性，可维护性。 无论是什么项目，都有一个从">
<meta name="keywords" content="refactor">
<meta property="og:type" content="article">
<meta property="og:title" content="重构代码">
<meta property="og:url" content="https://liluoao.github.io/2018/04/重构代码/index.html">
<meta property="og:site_name" content="To be a Web Artisan">
<meta property="og:description" content="原文链接：https://juejin.im/post/5adc8e18518825672b0352a8  重构不是对以前代码的全盘否定，而是利用更好的方式，写出更好，更有维护性代码。不断的追求与学习，才有更多的进步。  什么是重构首先，重构不是重写。重构大概的意思是在不影响项目的功能使用前提下，使用一系列的重构方式，改变项目的内部结构。提高项目内部的可读性，可维护性。 无论是什么项目，都有一个从">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2018-04-27T08:47:11.391Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="重构代码">
<meta name="twitter:description" content="原文链接：https://juejin.im/post/5adc8e18518825672b0352a8  重构不是对以前代码的全盘否定，而是利用更好的方式，写出更好，更有维护性代码。不断的追求与学习，才有更多的进步。  什么是重构首先，重构不是重写。重构大概的意思是在不影响项目的功能使用前提下，使用一系列的重构方式，改变项目的内部结构。提高项目内部的可读性，可维护性。 无论是什么项目，都有一个从">
<meta name="twitter:creator" content="@liluoao">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">To be a Web Artisan</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">文章列表</a>
        
          <a class="main-nav-link" href="/categories/laravel">Laravel</a>
        
          <a class="main-nav-link" href="/categories/phalcon">Phalcon</a>
        
          <a class="main-nav-link" href="/categories/mysql">MySQL</a>
        
          <a class="main-nav-link" href="/me.html">关于作者</a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://liluoao.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-重构代码" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/重构代码/" class="article-date">
  <time datetime="2018-04-23T08:44:52.000Z" itemprop="datePublished">2018-04-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      重构代码
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>原文链接：<a href="https://juejin.im/post/5adc8e18518825672b0352a8" target="_blank" rel="noopener">https://juejin.im/post/5adc8e18518825672b0352a8</a></p>
<blockquote>
<p>重构不是对以前代码的全盘否定，而是利用更好的方式，写出更好，更有维护性代码。不断的追求与学习，才有更多的进步。</p>
</blockquote>
<h2 id="什么是重构"><a href="#什么是重构" class="headerlink" title="什么是重构"></a>什么是重构</h2><p>首先，重构不是重写。重构大概的意思是在不影响项目的功能使用前提下，使用一系列的重构方式，改变项目的内部结构。提高项目内部的可读性，可维护性。</p>
<p>无论是什么项目，都有一个从简单到复杂的一个迭代过程。在这个过程里面，在不影响项目的使用情况下，需要不断的对代码进行优化，保持或者增加代码的可读性，可维护性。这样一来，就可以避免在团队协作开发上需要大量的沟通，交流。才能加入项目的开发中。</p>
<h2 id="为什么重构"><a href="#为什么重构" class="headerlink" title="为什么重构"></a>为什么重构</h2><p>随着业务需求的不断增加，变更，舍弃，项目的代码也难免会出现瑕疵，这就会影响代码的可读性，可维护性，甚至影响项目的性能。而重构的目的，就是为了解决这些瑕疵，保证代码质量和性能。但是前提是不能影响项目的使用。</p>
<p>至于重构的原因，自己总结了一下，大概有以下几点</p>
<ol>
<li>函数逻辑结构混乱，或因为没注释原因，连原代码写作者都很难理清当中的逻辑。</li>
<li>函数无扩展性可言，遇到新的变化，不能灵活的处理。</li>
<li>因为对象强耦合或者业务逻辑的原因，导致业务逻辑的代码巨大，维护的时候排查困难。</li>
<li>重复代码太多，没有复用性。</li>
<li>随着技术的发展，代码可能也需要使用新特性进行修改。</li>
<li>随着学习的深入，对于以前的代码，是否有着更好的一个解决方案。</li>
<li>因为代码的写法，虽然功能正常使用，但是性能消耗较多，需要换方案进行优化</li>
</ol>
<h2 id="何时重构"><a href="#何时重构" class="headerlink" title="何时重构"></a>何时重构</h2><p>在我的理解中，重构可以说是贯穿整一个项目的开发和维护周期，可以当作重构就是开发的一部分。通俗讲，在开发的任何时候，只要看到代码有别扭，激发了强迫症，就可以考虑重构了。只是，重构之前先参考下面几点。</p>
<ul>
<li>首先，重构是需要花时间去做的一件事。花的时间可能比之前的开发时间还要多。</li>
<li>其次，重构是为了把代码优化，前提是不能影响项目的使用。</li>
<li>最后，重构的难度大小不一，可能只是稍微改动，可能难度比之前开发还要难。</li>
</ul>
<p>基于上面的几点，需要大家去评估是否要进行重构。评估的指标，可以参考下面几点</p>
<ul>
<li>数量: 需要重构的代码是否过多。</li>
<li>质量: 可读性，可维护性，代码逻辑复杂度，等问题，对代码的质量影响是否到了一个难以忍受的地步。</li>
<li>时间: 是否有充裕的时间进行重构和测试。</li>
<li>效果: 如果重构了代码，得到哪些改善，比如代码质量提高了，性能提升了，更好的支持后续功能等。<a id="more"></a>
<h2 id="怎么重构"><a href="#怎么重构" class="headerlink" title="怎么重构"></a>怎么重构</h2><h4 id="函数无扩展性"><a href="#函数无扩展性" class="headerlink" title="函数无扩展性"></a>函数无扩展性</h4>如下面一个例子，在我一个库的其中一个 API<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//检测字符串</span></span><br><span class="line"><span class="comment">//checkType('165226226326','mobile')</span></span><br><span class="line"><span class="comment">//result：false</span></span><br><span class="line"><span class="keyword">let</span> checkType=<span class="function"><span class="keyword">function</span>(<span class="params">str, type</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'email'</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="regexp">/^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$/</span>.test(str);</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'mobile'</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="regexp">/^1[3|4|5|7|8][0-9]&#123;9&#125;$/</span>.test(str);</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'tel'</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="regexp">/^(0\d&#123;2,3&#125;-\d&#123;7,8&#125;)(-\d&#123;1,4&#125;)?$/</span>.test(str);</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'number'</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="regexp">/^[0-9]$/</span>.test(str);</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'english'</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="regexp">/^[a-zA-Z]+$/</span>.test(str);</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'text'</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="regexp">/^\w+$/</span>.test(str);</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'chinese'</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="regexp">/^[\u4E00-\u9FA5]+$/</span>.test(str);</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'lower'</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="regexp">/^[a-z]+$/</span>.test(str);</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'upper'</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="regexp">/^[A-Z]+$/</span>.test(str);</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>这个 API 看着没什么毛病，能检测常用的一些数据。但是有以下两个问题。</p>
<ol>
<li>但是如果想到添加其他规则的呢？就得在函数里面增加 case 。添加一个规则就修改一次！这样违反了开放-封闭原则（对扩展开放，对修改关闭）。而且这样也会导致整个 API 变得臃肿，难维护。</li>
<li>还有一个问题就是，比如A页面需要添加一个金额的校验，B页面需要一个日期的校验，但是金额的校验只在A页面需要，日期的校验只在B页面需要。如果一直添加 case 。就是导致A页面把只在B页面需要的校验规则也添加进去，造成不必要的开销。B页面也同理。</li>
</ol>
<p>建议的方式是给这个 API 增加一个扩展的接口<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> checkType=(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> rules=&#123;</span><br><span class="line">        email(str)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="regexp">/^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$/</span>.test(str);</span><br><span class="line">        &#125;,</span><br><span class="line">        mobile(str)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="regexp">/^1[3|4|5|7|8][0-9]&#123;9&#125;$/</span>.test(str);</span><br><span class="line">        &#125;,</span><br><span class="line">        tel(str)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="regexp">/^(0\d&#123;2,3&#125;-\d&#123;7,8&#125;)(-\d&#123;1,4&#125;)?$/</span>.test(str);</span><br><span class="line">        &#125;,</span><br><span class="line">        number(str)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="regexp">/^[0-9]$/</span>.test(str);</span><br><span class="line">        &#125;,</span><br><span class="line">        english(str)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="regexp">/^[a-zA-Z]+$/</span>.test(str);</span><br><span class="line">        &#125;,</span><br><span class="line">        text(str)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="regexp">/^\w+$/</span>.test(str);</span><br><span class="line">        &#125;,</span><br><span class="line">        chinese(str)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="regexp">/^[\u4E00-\u9FA5]+$/</span>.test(str);</span><br><span class="line">        &#125;,</span><br><span class="line">        lower(str)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="regexp">/^[a-z]+$/</span>.test(str);</span><br><span class="line">        &#125;,</span><br><span class="line">        upper(str)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="regexp">/^[A-Z]+$/</span>.test(str);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//暴露接口</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="comment">//校验</span></span><br><span class="line">        check(str, type)&#123;</span><br><span class="line">            <span class="keyword">return</span> rules[type]?rules[type](str):<span class="literal">false</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">//添加规则</span></span><br><span class="line">        addRule(type,fn)&#123;</span><br><span class="line">            rules[type]=fn;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="comment">//调用方式</span></span><br><span class="line"><span class="comment">//使用mobile校验规则</span></span><br><span class="line"><span class="built_in">console</span>.log(checkType.check(<span class="string">'188170239'</span>,<span class="string">'mobile'</span>));</span><br><span class="line"><span class="comment">//添加金额校验规则</span></span><br><span class="line">checkType.addRule(<span class="string">'money'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="regexp">/^[0-9]+(.[0-9]&#123;2&#125;)?$/</span>.test(str)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//使用金额校验规则</span></span><br><span class="line"><span class="built_in">console</span>.log(checkType.check(<span class="string">'18.36'</span>,<span class="string">'money'</span>));</span><br></pre></td></tr></table></figure></p>
<p>上面的代码，是多了一些，但是理解起来也没怎么费劲，而且拓展性也有了。</p>
<p>上面这个改进其实是使用了策略模式（把一系列的算法进行封装，使算法代码和逻辑代码可以相互独立，并且不会影响算法的使用）进行改进的。策略模式的概念理解起来有点绕，但是大家看着代码，应该不绕。</p>
<p>这里展开讲一点，在功能上来说，通过重构，给函数增加扩展性，这里实现了。但是如果上面的 <code>checkType</code> 是一个开源项目的 <code>API</code>，重构之前调用方式是：<code>checkType(&#39;165226226326&#39;,&#39;phone&#39;)</code> 。重构之后调用方式是： <code>checkType.check(&#39;188170239&#39;,&#39;phone&#39;);</code> 或者 <code>checkType.addRule();</code>。如果开源项目的作者按照上面的方式重构，那么之前使用了开源项目的 <code>checkType</code> 这个 <code>API</code> 的开发者，就可能悲剧了，因为只要开发者一更新这个项目版本，就有问题。因为上面的重构没有做向下兼容。</p>
<p>如果要向下兼容，其实也不难。加一个判断而已。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> checkType=(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> rules=&#123;</span><br><span class="line">        email(str)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="regexp">/^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$/</span>.test(str);</span><br><span class="line">        &#125;,</span><br><span class="line">        mobile(str)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="regexp">/^1[3|4|5|7|8][0-9]&#123;9&#125;$/</span>.test(str);</span><br><span class="line">        &#125;,</span><br><span class="line">        tel(str)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="regexp">/^(0\d&#123;2,3&#125;-\d&#123;7,8&#125;)(-\d&#123;1,4&#125;)?$/</span>.test(str);</span><br><span class="line">        &#125;,</span><br><span class="line">        number(str)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="regexp">/^[0-9]$/</span>.test(str);</span><br><span class="line">        &#125;,</span><br><span class="line">        english(str)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="regexp">/^[a-zA-Z]+$/</span>.test(str);</span><br><span class="line">        &#125;,</span><br><span class="line">        text(str)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="regexp">/^\w+$/</span>.test(str);</span><br><span class="line">        &#125;,</span><br><span class="line">        chinese(str)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="regexp">/^[\u4E00-\u9FA5]+$/</span>.test(str);</span><br><span class="line">        &#125;,</span><br><span class="line">        lower(str)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="regexp">/^[a-z]+$/</span>.test(str);</span><br><span class="line">        &#125;,</span><br><span class="line">        upper(str)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="regexp">/^[A-Z]+$/</span>.test(str);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//暴露接口</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">str,type</span>)</span>&#123;</span><br><span class="line">        <span class="comment">//如果type是函数，就扩展rules，否则就是验证数据</span></span><br><span class="line">        <span class="keyword">if</span>(type.constructor===<span class="built_in">Function</span>)&#123;</span><br><span class="line">            rules[str]=type;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> rules[type]?rules[type](str):<span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(checkType(<span class="string">'188170239'</span>,<span class="string">'mobile'</span>));</span><br><span class="line"></span><br><span class="line">checkType(<span class="string">'money'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="regexp">/^[0-9]+(.[0-9]&#123;2&#125;)?$/</span>.test(str)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//使用金额校验规则</span></span><br><span class="line"><span class="built_in">console</span>.log(checkType(<span class="string">'18.36'</span>,<span class="string">'money'</span>));</span><br></pre></td></tr></table></figure></p>
<p>这样运行能正常，也有扩展性性，但是对于代码洁癖的来说，这样写法不优雅。因为 <code>checkType</code> 违反了函数单一原则。一个函数负责过多的职责可能会导致以后不可估量的问题，使用方面也很让人疑惑。</p>
<p>面对这样的情况，就个人而言，了解的做法是：保留 <code>checkType</code> ，不做任何修改，在项目里面增加一个新的 <code>API</code> ，比如 <code>checkTypOfString</code> ，把重构的代码写到 <code>checkTypOfString</code> 里面。通过各种方式引导开发者少旧 <code>checkType</code> ，多用 <code>checkTypOfString</code> 。之后的项目迭代里面，合适的时候废弃 <code>checkType</code> 。</p>
<h4 id="函数违反单一原则"><a href="#函数违反单一原则" class="headerlink" title="函数违反单一原则"></a>函数违反单一原则</h4><p>函数违反单一原则最大一个后果就是会导致逻辑混乱。如果一个函数承担了太多的职责，不妨试下：函数单一原则 – 一个函数只做一件事。</p>
<p>如下例子<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//现有一批的录入学生信息，但是数据有重复，需要把数据进行去重。然后把为空的信息，改成保密。</span></span><br><span class="line"><span class="keyword">let</span> students=[</span><br><span class="line">    &#123;</span><br><span class="line">        id:<span class="number">1</span>,</span><br><span class="line">        name:<span class="string">'守候'</span>,</span><br><span class="line">        sex:<span class="string">'男'</span>,</span><br><span class="line">        age:<span class="string">''</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        id:<span class="number">2</span>,</span><br><span class="line">        name:<span class="string">'浪迹天涯'</span>,</span><br><span class="line">        sex:<span class="string">'男'</span>,</span><br><span class="line">        age:<span class="string">''</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        id:<span class="number">1</span>,</span><br><span class="line">        name:<span class="string">'守候'</span>,</span><br><span class="line">        sex:<span class="string">''</span>,</span><br><span class="line">        age:<span class="string">''</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        id:<span class="number">3</span>,</span><br><span class="line">        name:<span class="string">'鸿雁'</span>,</span><br><span class="line">        sex:<span class="string">''</span>,</span><br><span class="line">        age:<span class="string">'20'</span></span><br><span class="line">    &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//数组去重</span></span><br><span class="line">    <span class="keyword">let</span> _arr=[],_arrIds=[];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;arr.length;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(_arrIds.indexOf(arr[i].id)===<span class="number">-1</span>)&#123;</span><br><span class="line">            _arrIds.push(arr[i].id);</span><br><span class="line">            _arr.push(arr[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//遍历替换</span></span><br><span class="line">    _arr.map(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> item)&#123;</span><br><span class="line">            <span class="keyword">if</span>(item[key]===<span class="string">''</span>)&#123;</span><br><span class="line">                item[key]=<span class="string">'保密'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> _arr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(handle(students))</span><br></pre></td></tr></table></figure></p>
<p>运行结果没有问题，但是大家想一下，如果以后，如果改了需求，比如，学生信息不会再有重复的记录，要求把去重的函数去掉。这样一来，就是整个函数都要改了。还影响到下面的操作流程。相当于了改了需求，整个方法全跪。城门失火殃及池鱼。</p>
<p>下面使用单一原则构造一下<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> handle=&#123;</span><br><span class="line">    removeRepeat(arr)&#123;</span><br><span class="line">        <span class="comment">//数组去重</span></span><br><span class="line">        <span class="keyword">let</span> _arr=[],_arrIds=[];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;arr.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(_arrIds.indexOf(arr[i].id)===<span class="number">-1</span>)&#123;</span><br><span class="line">                _arrIds.push(arr[i].id);</span><br><span class="line">                _arr.push(arr[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> _arr;</span><br><span class="line">    &#125;,</span><br><span class="line">    setInfo(arr)&#123;</span><br><span class="line">        arr.map(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> item)&#123;</span><br><span class="line">                <span class="keyword">if</span>(item[key]===<span class="string">''</span>)&#123;</span><br><span class="line">                    item[key]=<span class="string">'保密'</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> arr;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">students=handle.removeRepeat(students);</span><br><span class="line">students=handle.setInfo(students);</span><br><span class="line"><span class="built_in">console</span>.log(students);</span><br></pre></td></tr></table></figure></p>
<p>结果一样，但是需求改下，比如不需要去重，把代码注释或者直接删除就好。这样相当于把函数的职责分离了，而且职责之前互不影响。中间去除那个步骤不会影响下一步。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//students=handle.removeRepeat(students);</span></span><br><span class="line">students=handle.setInfo(students);</span><br><span class="line"><span class="built_in">console</span>.log(students);</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://liluoao.github.io/2018/04/重构代码/" data-id="cjghpsd9m0022c4mj655ltyfd" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/refactor/">refactor</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/04/PHP的设计模式之行为模式（二）/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
        
          PHP的设计模式之行为模式（二）
        
      </div>
    </a>
  
  
    <a href="/2018/04/依赖注入/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">依赖注入</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/composer/">composer</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/laravel/">laravel</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/phalcon/">phalcon</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/wechat/">wechat</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/安全/">安全</a><span class="category-list-count">2</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ci/">ci</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/clean-code/">clean-code</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/culture/">culture</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dependency-injection/">dependency-injection</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/design-patterns/">design-patterns</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/laravel/">laravel</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/phalcon/">phalcon</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/refactor/">refactor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/restful/">restful</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sapi/">sapi</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/solid/">solid</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wechat/">wechat</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a><span class="tag-list-count">4</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/ci/" style="font-size: 10px;">ci</a> <a href="/tags/clean-code/" style="font-size: 10px;">clean-code</a> <a href="/tags/culture/" style="font-size: 17.5px;">culture</a> <a href="/tags/dependency-injection/" style="font-size: 10px;">dependency-injection</a> <a href="/tags/design-patterns/" style="font-size: 20px;">design-patterns</a> <a href="/tags/laravel/" style="font-size: 10px;">laravel</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/phalcon/" style="font-size: 12.5px;">phalcon</a> <a href="/tags/refactor/" style="font-size: 10px;">refactor</a> <a href="/tags/restful/" style="font-size: 10px;">restful</a> <a href="/tags/sapi/" style="font-size: 10px;">sapi</a> <a href="/tags/solid/" style="font-size: 10px;">solid</a> <a href="/tags/wechat/" style="font-size: 10px;">wechat</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a><span class="archive-list-count">18</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a><span class="archive-list-count">5</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/04/微信消息处理/">微信消息处理</a>
          </li>
        
          <li>
            <a href="/2018/04/PHP运行模式/">PHP运行模式</a>
          </li>
        
          <li>
            <a href="/2018/04/Nginx和PHP的配置/">Nginx和PHP的配置</a>
          </li>
        
          <li>
            <a href="/2018/04/SOLID/">SOLID</a>
          </li>
        
          <li>
            <a href="/2018/04/PHP的设计模式之行为模式（三）/">PHP的设计模式之行为模式（三）</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <div class="footer-copyright">
        &copy; 2018 李罗奥<br>
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
      </div>
      <div class="footer-about-me">
        关于作者<br>
        <a href="https://github.com/liluoao" target="_blank" title="GitHub">GitHub</a><br>
        <a href="https://segmentfault.com/u/liluoao" target="_blank" title="SegmentFault">SegmentFault</a><br>
        <a href="https://laravel-china.org/users/7144" target="_blank" title="LaravelChina">LaravelChina</a><br>
        <a href="https://gitee.com/liluoao" target="_blank" title="码云">码云</a><br>
        <a href="https://juejin.im/user/5a19374cf265da4332274600" target="_blank" title="掘金">掘金</a><br>
        <a href="https://packagist.org/users/liluoao/" target="_blank" title="Packagist">Packagist</a><br>
        <a href="https://www.gitbook.com/@liluoao" target="_blank" title="GitBook">GitBook</a>
      </div>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">文章列表</a>
  
    <a href="/categories/laravel" class="mobile-nav-link">Laravel</a>
  
    <a href="/categories/phalcon" class="mobile-nav-link">Phalcon</a>
  
    <a href="/categories/mysql" class="mobile-nav-link">MySQL</a>
  
    <a href="/me.html" class="mobile-nav-link">关于作者</a>
  
</nav>
    

<script src="//lib.sinaapp.com/js/jquery/3.1.0/jquery-3.1.0.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>